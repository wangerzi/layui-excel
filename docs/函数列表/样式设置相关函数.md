# æ ·å¼è®¾ç½®ç›¸å…³å‡½æ•°

> æ ·å¼è®¾ç½®åŒ…æ‹¬ï¼Œç»™è¡¨æ ¼è®¾ç½®è¾¹æ¡†ï¼Œæ·»åŠ èƒŒæ™¯è‰²ï¼Œæ·»åŠ å›¾ç‰‡ï¼Œæ”¹å­—å·ï¼Œæ–‡å­—å±€ä¸­ï¼Œè®¾ç½®è¡Œé«˜åˆ—å®½ï¼Œåˆå¹¶å•å…ƒæ ¼ç­‰åŠŸèƒ½ï¼Œå¼€å‘äº†è¯¸å¦‚ setExportCellStyle è¾…åŠ©æ·»åŠ æ ·å¼ï¼ŒsetRoundBorder ç”¨äºè°ƒæ•´è¾¹æ¡†ç­‰ï¼ŒmakeRowConf è°ƒæ•´è¡Œé«˜ï¼ŒmakeColConf è°ƒæ•´åˆ—å®½ï¼ŒmakeMergeConf å¤„ç†åˆå¹¶ã€‚

#### setExportCellStyle å‚æ•°é…ç½®

> è¾…åŠ©æ–¹æ³•ï¼šä¸º sheet çº§åˆ«çš„æ•°æ®æ‰¹é‡è®¾ç½®å•å…ƒæ ¼å±æ€§ï¼Œè¯·ä¸€å®šæ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°è¦ç»è¿‡ filter å‡½æ•°çš„å¤„ç†ï¼Œä¿è¯ key çš„é¡ºåºå’Œå®Œæ•´ï¼Œå¦‚æœä¼ å…¥ç¬¬å››ä¸ªå‚æ•°ï¼ˆå›è°ƒå‡½æ•°ï¼‰ï¼Œå•å…ƒæ ¼æ•°æ®å°†ä¼šä»¥å›è°ƒå‡½æ•°è¿”å›çš„æ•°æ®ä¸ºå‡†

| å‚æ•°åç§° | æè¿°                                                         | é»˜è®¤å€¼                   |
| -------- | ------------------------------------------------------------ | ------------------------ |
| data     | sheetçº§åˆ«çš„æ•°æ®                                              | undefined                |
| range    | èŒƒå›´å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚`" A1:C12"`è¡¨ç¤ºå¼€å§‹ä½ç½®é»˜è®¤ A1ï¼Œç»“æŸä½ç½®C12ï¼Œç›®å‰è¿˜ä¸æ”¯æŒå…¶ä»–æ ¼å¼ï¼Œè¯·ä¸è¦å†™ `A~B,1~2`ç­‰è‡ªåˆ›å†™æ³• | æ•°æ®èŒƒå›´å†…å·¦ä¸Šè§’åˆ°å³ä¸‹è§’ |
| config   | æ‰¹é‡è®¾ç½®çš„å•å…ƒæ ¼å±æ€§ï¼Œå¦‚æœæ²¡æœ‰å›è°ƒå‡½æ•°è¿”å›åˆ™æ ·å¼åˆå¹¶ï¼Œå­˜åœ¨å›è°ƒè¿”å›åˆ™ä»¥è¿”å›å€¼ä¸ºå‡† | undefined                |
| filter   | å›è°ƒå‡½æ•°ï¼Œä¼ é€’å‡½æ•°ç”Ÿæ•ˆï¼Œè¿”å›å€¼ä½œä¸ºæ–°çš„å€¼ï¼ˆå¯ç”¨äºè¿‡æ»¤ã€è§„åˆ™æ›¿æ¢æ ·å¼ç­‰éªšæ“ä½œï¼‰**ã€éå¿…å¡«å‚æ•°ã€** | undefined                |

##### filterå…¥å‚åˆ—è¡¨

> æ­¤å‚æ•°é€‰å¡«ï¼Œå¦‚æœä¸ä¼ å…¥åˆ™ç›´æ¥æŒ‰ç…§è§„åˆ™è¦†ç›–

| å‚æ•°åç§°   | æè¿°                                             |
| ---------- | ------------------------------------------------ |
| cell       | åŸæœ‰å•å…ƒæ ¼æ•°æ®                                   |
| newCell    | æ ¹æ®æ‰¹é‡è®¾ç½®è§„åˆ™è‡ªåŠ¨ç”Ÿæˆæ ·å¼çš„å•å…ƒæ ¼æ•°æ®ï¼ˆåˆå¹¶ï¼‰ |
| row        | æ‰€åœ¨è¡Œæ•°æ®                                       |
| config     | ä¼ å…¥çš„é…ç½®                                       |
| currentCol | å½“å‰åˆ—ç´¢å¼•                                       |
| fieldKey   | å½“å‰å­—æ®µkey                                      |

##### è°ƒç”¨æ ·ä¾‹(æ›´å¤šç”¨æ³•å¯å‚è€ƒ index.js ä¸­çš„æ ·ä¾‹)

> å¦‚æœæƒ³åŠ¨æ€çš„ä¼ å…¥èŒƒå›´ A1:C{æ•°æ®é•¿åº¦}ï¼Œå¯ä»¥å°†ç¬¬äºŒä¸ªå‚æ•°æ”¹ä¸º `'A1:C'+data.length`

```javascript
// 1. å‡è®¾çš„æ¢³ç†åçš„åå°çš„æ•°æ®(çœç•¥filterå‡½æ•°æ¢³ç†)
var data = [
    { username: '520',sex: 'ç”·', city: 'J', 'score': 100, 'start': '2019-03-11' },
    { username: '520',sex: 'å¥³', city: 'X', 'score': 100, 'start': '2019-03-11' },
    { username: '520',sex: 'ç”·', city: 'ä¸Šæµ·', 'score': 100, 'start': '2019-03-11' }
];
// 2. è°ƒç”¨è®¾ç½®æ ·å¼çš„å‡½æ•°ï¼Œä¼ å…¥è®¾ç½®çš„èŒƒå›´ï¼Œæ”¯æŒå›è°ƒ
excel.setExportCellStyle(data, 'A1:C3', {
    s: {
        fill: { bgColor: { indexed: 64 }, fgColor: { rgb: "FF0000" } },
        alignment: {
            horizontal: 'center',
            vertical: 'center'
        }
    }
}, function(cell, newCell, row, config, currentRow, currentCol, fieldKey) {
    // å›è°ƒå‚æ•°ï¼Œcell:åŸæœ‰æ•°æ®ï¼ŒnewCell:æ ¹æ®æ‰¹é‡è®¾ç½®è§„åˆ™è‡ªåŠ¨ç”Ÿæˆçš„æ ·å¼ï¼Œrow:æ‰€åœ¨è¡Œæ•°æ®ï¼Œconfig:ä¼ å…¥çš„é…ç½®,currentRow:å½“å‰è¡Œç´¢å¼•,currentCol:å½“å‰åˆ—ç´¢å¼•ï¼ŒfieldKey:å½“å‰å­—æ®µç´¢å¼•
    return ((currentRow + currentCol) % 2 === 0) ? newCell : cell;// éš”è¡Œéš”åˆ—ä¸Šè‰²
} );
// 3. å¯¼å‡ºæ•°æ®
excel.exportExcel(data, 'æ‰¹é‡è®¾ç½®æ ·å¼.xlsx', 'xlsx');
```

#### setRoundBorder å‚æ•°é…ç½®

> è¾…åŠ©æ–¹æ³•ï¼šè®¾ç½®èŒƒå›´å†…ç¯ç»•çš„è¾¹æ¡†
> 
>ã€æ³¨ã€‘æ­¤æ–¹æ³•åº•å±‚ä¸ setExportCellStyle æ–¹æ³•ä¸€è‡´ï¼Œæ‰€ä»¥åœ¨ä¸¤ä¸ªæ–¹æ³•æ··åˆè°ƒç”¨ä¸‹å¯èƒ½ä¼šå¯¼è‡´æ ·å¼è¦†ç›–ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨ setExportCellStyle çš„å›è°ƒæ¨¡å¼ä¹‹æ—¶

| å‚æ•°åç§° | æè¿°                                                         | é»˜è®¤å€¼                                        |
| -------- | ------------------------------------------------------------ | --------------------------------------------- |
| data     | Sheetçº§åˆ«çš„æ•°æ®                                              | []                                            |
| range    | èŒƒå›´å­—ç¬¦ä¸²ï¼Œå¦‚ A1:C12ï¼Œé»˜è®¤ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’                  | "A1:C12"                                      |
| config   | border ä¸Šä¸‹å·¦å³å±æ€§é…ç½®ä¿¡æ¯ï¼ˆå¯¹è§’çº¿çš„ä¸‰ä¸ªå±æ€§è¢«ä¸‹æ”¾åˆ°left/right/top/bottomä¸‹ï¼‰ | {top: {xxx}, bottom: {}, left: {}, right: {}} |

##### è°ƒç”¨æ ·ä¾‹

```javascript
LAY_EXCEL.setRoundBorder(list, 'A1:C2', {
    top: {style: 'thick', color: {rgb: 'FFFF0000'}},
    bottom: {style: 'thick', color: {rgb: 'FFFF0000'}},
    left: {style: 'thick', color: {rgb: 'FFFF0000'}},
    right: {style: 'thick', color: {rgb: 'FFFF0000'}}
});
```

#### makeMergeConfig å‚æ•°é…ç½®

> è¾…åŠ©æ–¹æ³•ï¼šç”¨äºç”Ÿæˆåˆå¹¶è¡¨æ ¼çš„é…ç½®é¡¹ï¼Œæ³¨æ„éœ€è¦ä¼ å…¥åˆ° exportExcel çš„ opt.extend['!merge'] ä¸­

| å‚æ•°åç§° | æè¿°     | é»˜è®¤å€¼    |
| -------- | -------- | --------- |
| origin   | äºŒç»´æ•°ç»„ | undefined |

##### è°ƒç”¨æ ·ä¾‹

> å¦‚ä¸‹ä»£ç è¡¨ç¤ºåˆå¹¶ A1~E1 è¡Œï¼Œå¹¶ä¸”åˆå¹¶ A2~D4è¡Œï¼Œå¦‚æœæœ‰åŠ¨æ€åˆå¹¶åˆ—çš„éœ€æ±‚ï¼Œè¯·ä½¿ç”¨ JS å¾ªç¯ç”Ÿæˆå‚æ•°ä¼ å…¥

```javascript
var mergeConf = excel.makeMergeConfig([
    ['A1', 'E1'],
    ['A2', 'D4']
]);
excel.exportExcel({
    sheet1: data
}, 'æµ‹è¯•å¯¼å‡ºå¤æ‚è¡¨å¤´.xlsx', 'xlsx', {
    extend: {
        // éœ€ä¼ å…¥ç”Ÿæˆå¥½çš„é…ç½®ä¿¡æ¯
        '!merges': mergeConf
    }
});
```

#### makeColConfig å‚æ•°é…ç½®

> è¾…åŠ©æ–¹æ³•ï¼šç”Ÿæˆåˆ—å®½é…ç½®ï¼Œè¿”å›ç»“æœéœ€æ”¾ç½®äºopt.extend['!cols']ä¸­

| å‚æ•°åç§°   | æè¿°                                                  | é»˜è®¤å€¼ |
| ---------- | ----------------------------------------------------- | ------ |
| data       | ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡çš„keyä»£è¡¨åˆ—ï¼ˆå¦‚ï¼šABCDEï¼‰ï¼Œvalueä»£è¡¨å®½åº¦ | null   |
| defaultNum | æ¸²æŸ“è¿‡ç¨‹ä¸­æœªæŒ‡å®šå•å…ƒæ ¼çš„é»˜è®¤å®½åº¦                      | 60     |

##### ä½¿ç”¨æ ·ä¾‹

> keyè¡¨ç¤ºåˆ—ï¼Œvalueè¡¨ç¤ºå®½ï¼Œ**é…ç½®æœ€å°åˆ—å’Œæœ€å¤§åˆ—ä¹‹é—´æœªå®šä¹‰çš„åˆ—å®½å–é…ç½®çš„é»˜è®¤å€¼**ï¼Œç‰¹åˆ«æ³¨æ„è¦æ”¾åœ¨ opt.extend['!cols'] ä¸­
> è¿™é‡Œéå¸¸æ„Ÿè°¢ç¾¤é‡Œçš„ã€å°æ˜ŸçƒğŸ¦ã€åŒå­¦ï¼Œéå¸¸ç»†è‡´çš„æ‰¾å‡ºäº†è¡Œé«˜åˆ—å®½çš„å•ä½é”™è¯¯

```javascript
// æ„æ€æ˜¯ï¼šAåˆ—40ï¼ŒBåˆ—80(è¢«è®¾ç½®é»˜è®¤åˆ—å®½)ï¼ŒCåˆ—120pxï¼ŒDã€Eã€Fç­‰å‡æœªå®šä¹‰ï¼ˆè¡¨æ ¼é»˜è®¤åˆ—å®½ï¼Œé 80ï¼‰ï¼Œå•ä½æ˜¯ç£…
var colConf = excel.makeColConfig({
    'A': 40,
    'C': 120
}, 80);
excel.exportExcel({
    sheet1: data
}, 'æµ‹è¯•å¯¼å‡ºå¤æ‚è¡¨å¤´.xlsx', 'xlsx', {
    extend: {
        '!cols': colConf
    }
});
```

#### makeRowConfig å‚æ•°é…ç½®

> è¾…åŠ©æ–¹æ³•ï¼šç”Ÿæˆåˆ—å®½é…ç½®ï¼Œè¿”å›ç»“æœéœ€æ”¾ç½®äºopt.extend['!rows']ä¸­

| å‚æ•°åç§°   | æè¿°                                                         | é»˜è®¤å€¼ |
| ---------- | ------------------------------------------------------------ | ------ |
| data       | ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡çš„keyä»£è¡¨ä»1å¼€å§‹çš„è¡Œï¼ˆå¦‚ï¼š1234ï¼‰ï¼Œvalueä»£è¡¨é«˜åº¦ | null   |
| defaultNum | æ¸²æŸ“è¿‡ç¨‹ä¸­æœªæŒ‡å®šå•å…ƒæ ¼çš„é»˜è®¤å®½åº¦                             | 60     |

##### ä½¿ç”¨æ ·ä¾‹

> keyè¡¨ç¤ºè¡Œï¼Œvalueè¡¨ç¤ºé«˜åº¦ï¼Œ**é…ç½®æœ€å°è¡Œå’Œæœ€å¤§è¡Œä¹‹é—´æœªå®šä¹‰çš„è¡Œé«˜å–é…ç½®çš„é»˜è®¤å€¼**ï¼Œç‰¹åˆ«æ³¨æ„è¦æ”¾åœ¨ opt.extend['!rows'] ä¸­

```javascript
// æ„æ€æ˜¯ï¼š1è¡Œ40ï¼Œ2è¡Œ80(è¢«è®¾ç½®äº†é»˜è®¤åˆ—å®½)ï¼Œ3è¡Œ120pxï¼Œ4/5/6/7ç­‰è¡Œå‡æœªå®šä¹‰ï¼ˆè¡¨æ ¼é»˜è®¤è¡Œå®½ï¼Œé80ï¼‰ï¼Œ1å¤§çº¦å¯¹åº” 1.1ç£…ï¼Œç”±åº•å±‚æ§åˆ¶äº†ï¼Œå¹¶æœªåœ¨ä¸Šå±‚å°è£…çš„æ—¶å€™æ›´æ”¹å…¶å•ä½
var rowConf = excel.makeRowConfig({
    1: 40,
    3: 120
}, 80);
excel.exportExcel({
    sheet1: data
}, 'æµ‹è¯•å¯¼å‡ºå¤æ‚è¡¨å¤´.xlsx', 'xlsx', {
    extend: {
        '!rows': rowConf
    }
});
```

#### imageUrlToBase64 å‚æ•°é…ç½®

> è¾…åŠ©æ–¹æ³•ï¼šä¸‹è½½å›¾ç‰‡å¹¶è½¬æ¢ä¸º base64ï¼Œè¿”å›ç»“æœéœ€æ”¾ç½®äº opt.extend['!images'] ä¸­

| å‚æ•°åç§°   | æè¿°                                                         | é»˜è®¤å€¼ |
| ---------- | ------------------------------------------------------------ | ------ |
| url       | å›¾ç‰‡åœ°å€ï¼Œæ³¨æ„è·¨åŸŸé—®é¢˜ | ""   |
| ext | æ‰©å±•åï¼Œé»˜è®¤æ˜¯æˆªå– url çš„æ–‡ä»¶æ‰©å±•åï¼Œæ”¯æŒå¸¦ ? å’Œ # çš„ URL è¯†åˆ«                           | ""     |

##### ä½¿ç”¨æ ·ä¾‹

> æ³¨æ„ï¼Œå…¶ä¸­ splitPosition(pos: string) å‡½æ•°ä¸€å¦‚å…¶åï¼Œç”¨äºå¿«é€Ÿç”Ÿæˆå•å…ƒæ ¼ä½ç½®é…ç½®

```javascript

// è¿™ä¸€æ®µæ˜¯æ¨¡æ‹Ÿç”Ÿæˆæ•°æ®ï¼Œç»“æ„æ˜¯ï¼š [{id: "", username: "", city: "", picture: ""}]
const data = new Array(5).fill({}).map((_, idx) => {
    return {
        id: idx,
        username: `name${idx}`,
        city: `åŸå¸‚${idx}`,
        picture:
        "https://img0.baidu.com/it/u=1588905690,3738625613&fm=253&fmt=auto&app=120&f=JPEG?w=801&h=500",
    };
});
// è¿™ä¸€æ®µä»£ç æ˜¯å¼‚æ­¥è¯·æ±‚å›¾ç‰‡çš„ç¤ºä¾‹ï¼Œå¦‚æœæœ¬èº«èƒ½å¤Ÿæ‹¿åˆ°å›¾ç‰‡ base64ï¼Œåˆ™æ— éœ€è¿™ä¸ªæ­¥éª¤
const asyncConcurrencyTask = [];
for (let index = 0; index < data.length; index++) {
    asyncConcurrencyTask.push(
        new Promise((resolve, reject) => {
        excel
            .imageUrlToBase64(data[index].picture, "jpg")
            .then((val) => {
            pictures.push(val.split(",")[1]);
            // æ³¨æ„ï¼šå¦‚æœä¸å¸Œæœ›è¡¨æ ¼ä¸­å‡ºç°å®é™…åœ°å€ï¼Œå¯ä»¥åœ¨å¾ªç¯ä¸­é©±é™¤
            data[index].picture = ""
            resolve();
            });
        })
    );
}
await Promise.allSettled(asyncConcurrencyTask);
// ä¸‹é¢æ˜¯å¯¼å‡ºéƒ¨åˆ†
excel.exportExcel({
    sheet1: data
}, 'æµ‹è¯•å¯¼å‡ºå¤æ‚è¡¨å¤´.xlsx', 'xlsx', {
    extend: {
        sheet1: {
            "!images": [
            //éœ€è¦ä¸ºæ¯ä¸ªå›¾ç‰‡è®¾ç½®ä½ç½®, å¯æ ¹æ®éœ€æ±‚åŠ¨æ€ç”Ÿæˆå›¾ç‰‡ä½ç½®ï¼ˆæ‹¼æ¥å­—ç¬¦ä¸²ï¼‰, æ­¤å¤„ä»…æ¼”ç¤ºç”¨æ³•
            {
                name: "image1.jpg",
                data: pictures[0],
                opts: { base64: true },
                position: {
                type: "twoCellAnchor",
                attrs: { editAs: "oneCell" },
                from: excel.splitPosition("D2"),
                to: excel.splitPosition("E3"),
                },
            },
            {
                name: "image2.jpg",
                data: pictures[1],
                opts: { base64: true },
                position: {
                type: "twoCellAnchor",
                attrs: { editAs: "oneCell" },
                from: excel.splitPosition("D3"),
                to: excel.splitPosition("E4"),
                },
            }
            ]
        }
    }
});
```

